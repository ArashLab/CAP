dataFiles:
    inVCF:
        disk:
            path: 1kg.micro.vcf.bgz
        commonOperations:
            annotateRows:
                info:
                    k1: v1
                    k2: v2
    outMT:
        disk:
            path: 1kg.ma.mt
        commonOperations:
            annotateRows:
                ef23: asf332
                filters:
                    - 'f1'
                    - 'f2'
                    - 'f3'
            annotateCols:
                cohort: xxx
                asdf: gasdf
            rename:
                s: sample
            addId:
                sampleId: sample
                variantId: CHR:POS:ALLELES
    outVCF:
        disk:
            path: 1kg.micro2.vcf.bgz
        commonOperations:
            annotateRows:
                rsid: 'rs123456'
    outMTx:
        disk:
            path: 1kg.xx.mt
    outRow:
        disk:
            path: 1kg.row.ht
    outCol:
        disk:
            path: 1kg.col.ht
    inPheno:
        disk:
            path: 1kg.pheno.tsv
            importParam:
                impute: True
    outPheno:
        disk:
            path: 1kg.pheno.ht

    pcaScore:
        disk:
            path: 1kg.pca.ht

    outPval1:
        disk:
            path: 1kg.pval1.ht

    outPval2:
        disk:
            path: 1kg.pval2.ht

#gzip -dc 1kg.micro2.vcf.bgz | head -n 98 | tail | cut -f 1-10 | column -t

executionPlan:
    - CO1
    # - CO2
    - SMT
    - KBT
    - PCA
    - ASSOC

stages:
    CO1:
        spec:
            function: CommonOperations
        io:
            inData:
                id: inVCF
                direction: input
            outData:
                id: outMT
                direction: output
    CO2:
        spec:
            function: CommonOperations
        io:
            inData:
                id: outMT
                direction: input
            outData:
                id: outVCF
                direction: output
    SMT:
        spec:
            function: SplitMatrixTable
        io:
            inData:
                id: outMT
                direction: input
            outData:
                id: outMTx
                direction: output
            outCol:
                id: outCol
                direction: output
            outRow:
                id: outRow
                direction: output
    KBT:
        spec:
            function: KeyByTable
        arg:
            keyCol: sampleId
            joinColKey: sample
            joinColData: ID
        io:
            inData:
                id: inPheno
                direction: input
            outData:
                id: outPheno
                direction: output
            keyTable:
                id: outCol
                direction: input
    PCA:
        spec:
            function: PcaHweNorm
        arg:
            numPcaVectors: 3
        io:
            inData:
                id: outMTx
                direction: input
            outScores:
                id: pcaScore
                direction: output

    ASSOC:
        spec:
            function: HailAssociation
        arg:
            resTables:
                - outData1
                - outData2
            tests:
                -   type: LogReg
                    subType: wald
                    covariates:
                        -   table: pca
                            cols:
                                - scores_1
                                - scores_2
                                - scores_3
                        # -   table: pheno
                        #     cols:
                        #         - sex
                    responseVariables:
                        -   tableId: pheno
                            cols:
                                -   colName: t2d
                                    testName: Binary-Pheno1
                                    resTableId: outData1
                                -   colName: t2d
                                    testName: Binary-Pheno2
                                    resTableId: outData1
                        -   tableId: pheno
                            cols:
                                -   colName: t2d
                                    testName: Binary-Pheno3
                                    resTableId: outData1
                                -   colName: t2d
                                    testName: Binary-Pheno4
                                    resTableId: outData2
                -   type: LogReg
                    subType: score
                    covariates:
                        -   table: pca
                            cols:
                                - scores_1
                        # -   table: pheno
                        #     cols:
                        #         - sex
                    responseVariables:
                        -   tableId: pheno
                            cols:
                                -   colName: t2d
                                    testName: Binary-Pheno1-LessPCA-Score
                                    resTableId: outData2
                                -   colName: t2d
                                    testName: Binary-Pheno2-LessPCA-Score
                                    resTableId: outData2
                        -   tableId: pheno
                            cols:
                                -   colName: t2d
                                    testName: Binary-Pheno3-LessPCA-Score
                                    resTableId: outData1
                                -   colName: t2d
                                    testName: Binary-Pheno4-LessPCA-Score
                                    resTableId: outData1
                -   type: LinReg
                    covariates:
                        -   table: pca
                            cols:
                                - scores_1
                                - scores_2
                        # -   table: pheno
                        #     cols:
                        #         - sex
                    responseVariables:
                        -   tableId: pheno
                            cols:
                                -   colName: bmi
                                    testName: Linear-Pheno1
                                    resTableId: outData1
                                -   colName: age
                                    testName: Linear-Pheno2
                                    resTableId: outData2
                        -   tableId: pca
                            cols:
                                -   colName: scores_3
                                    testName: Linear-Pheno3
                                    resTableId: outData2
        io:
            inData:
                id: outMTx
                direction: input
            outData1:
                id: outPval1
                direction: output
            outData2:
                id: outPval2
                direction: output
            pca:
                id: pcaScore
                direction: input
            pheno:
                id: outPheno
                direction: input

    
           